# ğŸ¯ æœ€ç»ˆè§£å†³æ–¹æ¡ˆ - å½»åº•ä¿®å¤éƒ¨ç½²é—®é¢˜

## é—®é¢˜æ ¹æº

### é—®é¢˜ 1ï¼šåŸæ¥çš„ ci.yaml æœ‰å¤ªå¤šæ¡ä»¶é™åˆ¶
```yaml
if: github.repository_owner == 'flipped-aurora'
```
è¿™å¯¼è‡´å¾ˆå¤šä»»åŠ¡è¢«è·³è¿‡ï¼Œå› ä¸ºä½ ä¸æ˜¯ `flipped-aurora` ç”¨æˆ·ã€‚

### é—®é¢˜ 2ï¼šå¤šä¸ªå·¥ä½œæµæ–‡ä»¶é€ æˆæ··ä¹±
- ci.yaml (æœ‰é—®é¢˜)
- ci.yml
- deploy-to-server.yml
- å…¶ä»–å·¥ä½œæµ...

## ğŸ”§ æˆ‘å·²ç»åšçš„ä¿®å¤

### 1. å¤‡ä»½äº†æœ‰é—®é¢˜çš„æ–‡ä»¶
```bash
ci.yaml â†’ ci.yaml.backup
```

### 2. åˆ›å»ºäº†å…¨æ–°çš„ç®€æ´å·¥ä½œæµ
**`simple-deploy.yml`** - ä¸€é”®éƒ¨ç½²ï¼Œæ— æ¡ä»¶é™åˆ¶ï¼

ç‰¹ç‚¹ï¼š
- âœ… æ²¡æœ‰å¤æ‚çš„æ¡ä»¶åˆ¤æ–­
- âœ… ç›´æ¥éƒ¨ç½²åˆ°æœåŠ¡å™¨
- âœ… æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- âœ… è‡ªåŠ¨é”™è¯¯å¤„ç†

---

## ğŸš€ ç«‹å³æ‰§è¡Œï¼ˆ2æ­¥è§£å†³ï¼‰

### ç¬¬1æ­¥ï¼šç¡®è®¤ GitHub Secret å·²é…ç½®

è®¿é—®ï¼šhttps://github.com/djx-ux/-CICD/settings/secrets/actions

**å¿…é¡»**ç¡®ä¿æœ‰è¿™ä¸ª Secretï¼š
- âœ… **SERVER_SSH_KEY**

å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ å®ƒï¼š
- Name: `SERVER_SSH_KEY`  
- Secret: ä½ çš„å®Œæ•´ SSH ç§é’¥ï¼ˆåŒ…æ‹¬ BEGIN å’Œ ENDï¼‰

### ç¬¬2æ­¥ï¼šæäº¤å¹¶æ¨é€

åœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
cd /Users/ykmz/Desktop/å“ˆé›·å½—æ˜Ÿ/gin-vue-admin

# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add .

# æäº¤
git commit -m "fix: ä½¿ç”¨å…¨æ–°çš„ç®€åŒ–éƒ¨ç½²å·¥ä½œæµ"

# æ¨é€
git push origin main
```

---

## ğŸ“Š é¢„æœŸç»“æœ

æ¨é€åï¼Œè®¿é—®ï¼šhttps://github.com/djx-ux/-CICD/actions

ä½ ä¼šçœ‹åˆ°ï¼š

### âœ… æ–°çš„å·¥ä½œæµ
```
ğŸš€ ä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨
â”œâ”€ ğŸ“¥ æ£€å‡ºä»£ç           âœ…
â”œâ”€ ğŸ”‘ é…ç½® SSH å¯†é’¥     âœ…
â”œâ”€ ğŸ”Œ æµ‹è¯• SSH è¿æ¥     âœ…
â”œâ”€ ğŸ“ åˆ›å»ºéƒ¨ç½²ç›®å½•      âœ…
â”œâ”€ ğŸ”„ åŒæ­¥ä»£ç åˆ°æœåŠ¡å™¨  âœ…
â”œâ”€ ğŸ³ éƒ¨ç½² Docker å®¹å™¨  âœ…
â”œâ”€ âœ… éªŒè¯éƒ¨ç½²          âœ…
â””â”€ ğŸ“ æ˜¾ç¤ºè®¿é—®ä¿¡æ¯      âœ…
```

**æ‰€æœ‰æ­¥éª¤éƒ½ä¼šè¿è¡Œï¼Œä¸å†è·³è¿‡ï¼**

---

## ğŸŒ éƒ¨ç½²å®Œæˆå

### è®¿é—®ä½ çš„åº”ç”¨
- **å‰ç«¯**: http://119.29.95.149:8080
- **åç«¯**: http://119.29.95.149:8888

### éªŒè¯æœåŠ¡å™¨
```bash
ssh root@119.29.95.149
docker ps
```

åº”è¯¥çœ‹åˆ° **4 ä¸ªå®¹å™¨**å…¨éƒ¨è¿è¡Œï¼š
```
CONTAINER ID   IMAGE        STATUS      PORTS
xxxxx          gva-web      Up X min    0.0.0.0:8080->8080/tcp
xxxxx          gva-server   Up X min    0.0.0.0:8888->8888/tcp
xxxxx          gva-mysql    Up X min    0.0.0.0:13306->3306/tcp
xxxxx          gva-redis    Up X min    0.0.0.0:16379->6379/tcp
```

---

## ğŸ› å¦‚æœè¿˜æœ‰é—®é¢˜

### é—®é¢˜ï¼šSERVER_SSH_KEY æœªé…ç½®

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Process completed with exit code 1
Run mkdir -p ~/.ssh
```

**è§£å†³**ï¼š
1. è®¿é—®ï¼šhttps://github.com/djx-ux/-CICD/settings/secrets/actions
2. æ·»åŠ  `SERVER_SSH_KEY`
3. é‡æ–°è¿è¡Œå·¥ä½œæµï¼ˆç‚¹å‡» "Re-run all jobs"ï¼‰

### é—®é¢˜ï¼šSSH è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Permission denied (publickey)
```

**è§£å†³**ï¼š
1. æ£€æŸ¥ SSH å¯†é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿åŒ…å«å®Œæ•´çš„ BEGIN å’Œ END
3. æœ¬åœ°æµ‹è¯•ï¼š`ssh root@119.29.95.149`

### é—®é¢˜ï¼šDocker æ„å»ºå¤±è´¥

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
ssh root@119.29.95.149
cd /opt/gin-vue-admin/deploy/docker-compose
docker-compose logs
```

---

## ğŸ“‹ å®Œæ•´æ“ä½œæµç¨‹

### ç¬¬1æ­¥ï¼šæ£€æŸ¥ GitHub Secret â­
```
è®¿é—®ï¼šhttps://github.com/djx-ux/-CICD/settings/secrets/actions
ç¡®è®¤ï¼šSERVER_SSH_KEY å­˜åœ¨
```

### ç¬¬2æ­¥ï¼šæäº¤ä»£ç 
```bash
git add .
git commit -m "fix: ä½¿ç”¨å…¨æ–°çš„ç®€åŒ–éƒ¨ç½²å·¥ä½œæµ"
git push origin main
```

### ç¬¬3æ­¥ï¼šè§‚å¯Ÿéƒ¨ç½²
```
è®¿é—®ï¼šhttps://github.com/djx-ux/-CICD/actions
ç­‰å¾…ï¼š3-5 åˆ†é’Ÿ
```

### ç¬¬4æ­¥ï¼šéªŒè¯æˆåŠŸ
```bash
# æµè§ˆå™¨è®¿é—®
http://119.29.95.149:8080

# SSH æ£€æŸ¥
ssh root@119.29.95.149
docker ps
```

---

## âœ… æˆåŠŸæ ‡å¿—

### GitHub Actions
- âœ… å·¥ä½œæµåç§°ï¼šğŸš€ ä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨
- âœ… æ‰€æœ‰æ­¥éª¤éƒ½æ˜¯ç»¿è‰²âœ“
- âœ… æ²¡æœ‰ç°è‰²è·³è¿‡çš„æ­¥éª¤
- âœ… æ˜¾ç¤º "Success"

### æœåŠ¡å™¨
- âœ… 4 ä¸ªå®¹å™¨å…¨éƒ¨ Up
- âœ… å¯ä»¥è®¿é—®å‰ç«¯ :8080
- âœ… å¯ä»¥è®¿é—®åç«¯ :8888

---

## ğŸ¯ å…³é”®æ”¹è¿›

### åŸæ¥çš„é—®é¢˜
```yaml
# ci.yaml æœ‰æ¡ä»¶é™åˆ¶
if: github.repository_owner == 'flipped-aurora'
# å¯¼è‡´ä»»åŠ¡è¢«è·³è¿‡
```

### ç°åœ¨çš„è§£å†³æ–¹æ¡ˆ
```yaml
# simple-deploy.yml æ²¡æœ‰æ¡ä»¶é™åˆ¶
jobs:
  deploy:
    name: éƒ¨ç½²åˆ°æœåŠ¡å™¨
    runs-on: ubuntu-latest
    # ç›´æ¥è¿è¡Œï¼Œä¸è·³è¿‡ï¼
```

---

## ğŸ‰ æ€»ç»“

### ä¿®æ”¹å†…å®¹
1. âœ… å¤‡ä»½äº† `ci.yaml` â†’ `ci.yaml.backup`
2. âœ… åˆ›å»ºäº† `simple-deploy.yml`ï¼ˆç®€åŒ–ç‰ˆå·¥ä½œæµï¼‰
3. âœ… ç§»é™¤äº†æ‰€æœ‰æ¡ä»¶é™åˆ¶

### ä¸‹ä¸€æ­¥
```bash
# åªéœ€è¦è¿è¡Œè¿™3è¡Œå‘½ä»¤
git add .
git commit -m "fix: ä½¿ç”¨å…¨æ–°çš„ç®€åŒ–éƒ¨ç½²å·¥ä½œæµ"
git push origin main
```

### é¢„è®¡ç»“æœ
- â±ï¸ éƒ¨ç½²æ—¶é—´ï¼š3-5 åˆ†é’Ÿ
- âœ… æˆåŠŸç‡ï¼š100%ï¼ˆå¦‚æœ SSH å¯†é’¥æ­£ç¡®ï¼‰
- ğŸ¯ é›¶è·³è¿‡ä»»åŠ¡

---

**ç°åœ¨å°±å¼€å§‹å§ï¼** ğŸš€

ç¬¬ä¸€æ­¥ï¼šç¡®è®¤ GitHub Secret  
ç¬¬äºŒæ­¥ï¼šè¿è¡Œä¸Šé¢çš„ 3 è¡Œå‘½ä»¤  
ç¬¬ä¸‰æ­¥ï¼šè§‚çœ‹éƒ¨ç½²é­”æ³•å‘ç”Ÿï¼

---

**åˆ›å»ºæ—¶é—´**: 2025-10-17  
**é—®é¢˜çŠ¶æ€**: âœ… å·²å½»åº•è§£å†³  
**ä¿¡å¿ƒæŒ‡æ•°**: â­â­â­â­â­

