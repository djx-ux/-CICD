# ğŸš€ ç«‹å³éƒ¨ç½² - å®Œæ•´æ­¥éª¤

## âœ… ä½ çš„é…ç½®ä¿¡æ¯

- **GitHub ä»“åº“**: `https://github.com/djx-ux/-CICD`
- **æœåŠ¡å™¨ IP**: `119.29.95.149`
- **SSH ç”¨æˆ·**: `root`
- **éƒ¨ç½²ç›®å½•**: `/opt/gin-vue-admin`

---

## ğŸ“ ç¬¬1æ­¥ï¼šé…ç½® GitHub Secretï¼ˆå¿…éœ€ï¼Œ2åˆ†é’Ÿï¼‰

### 1. æ‰“å¼€ GitHub Secrets é¡µé¢

ç›´æ¥è®¿é—®è¿™ä¸ªé“¾æ¥ï¼š

```
https://github.com/djx-ux/-CICD/settings/secrets/actions
```

### 2. æ·»åŠ  SSH å¯†é’¥

ç‚¹å‡»å³ä¸Šè§’çš„ **"New repository secret"** æŒ‰é’®

å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

**Nameï¼ˆåç§°ï¼‰**:
```
SERVER_SSH_KEY
```

**Secretï¼ˆå¯†é’¥å†…å®¹ï¼‰**:  
å¤åˆ¶ç²˜è´´ä»¥ä¸‹å®Œæ•´å†…å®¹ï¼ˆåŒ…æ‹¬å¼€å¤´å’Œç»“å°¾çš„æ¨ªçº¿ï¼‰ï¼š

```
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACD84jYWEqraE9+rb6uToRbGMHnxN9fgbXhdSLX79bpPHwAAAKAycg75MnIO
+QAAAAtzc2gtZWQyNTUxOQAAACD84jYWEqraE9+rb6uToRbGMHnxN9fgbXhdSLX79bpPHw
AAAEA6S7x5izDScoc1KdDCf/1jNa9lLCf0dEdoxMF74g33bPziNhYSqtoT36tvq5OhFsYw
efE31+BteF1Itfv1uk8fAAAAFnlvdXJfZW1haWxAZXhhbXBsZS5jb20BAgMEBQYH
-----END OPENSSH PRIVATE KEY-----
```

ç‚¹å‡» **"Add secret"** ä¿å­˜ã€‚

âœ… **å®Œæˆåä½ ä¼šçœ‹åˆ°**: Secret åˆ—è¡¨ä¸­å‡ºç° `SERVER_SSH_KEY`

---

## ğŸ“ ç¬¬2æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨ï¼ˆ1åˆ†é’Ÿï¼‰

åœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
# SSH è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨
ssh root@119.29.95.149
```

ç„¶ååœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p /opt/gin-vue-admin

# éªŒè¯ Docker å·²å®‰è£…
docker --version && docker-compose --version

# å¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·ï¼Œè¯´æ˜ Docker å·²å®‰è£… âœ…
# å¦‚æœæç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
# curl -fsSL https://get.docker.com | sh

# å®Œæˆåè¾“å…¥ exit é€€å‡ºæœåŠ¡å™¨
exit
```

---

## ğŸ“ ç¬¬3æ­¥ï¼šæ¨é€ä»£ç è§¦å‘éƒ¨ç½²ï¼ˆ1åˆ†é’Ÿï¼‰

å›åˆ°ä½ çš„æœ¬åœ°é¡¹ç›®ç›®å½•ï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
# ç¡®ä¿åœ¨é¡¹ç›®ç›®å½•
cd /Users/ykmz/Desktop/å“ˆé›·å½—æ˜Ÿ/gin-vue-admin

# æŸ¥çœ‹å½“å‰åˆ†æ”¯
git branch

# æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# æäº¤æ›´æ”¹
git commit -m "feat: é…ç½®è‡ªåŠ¨åŒ–CI/CDéƒ¨ç½²åˆ°æœåŠ¡å™¨"

# æ¨é€åˆ° GitHubï¼ˆè§¦å‘è‡ªåŠ¨éƒ¨ç½²ï¼‰
git push origin main
```

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ develop åˆ†æ”¯ï¼Œæ”¹æˆï¼š
```bash
git push origin develop
```

---

## ğŸ“Š ç¬¬4æ­¥ï¼šè§‚å¯Ÿéƒ¨ç½²è¿‡ç¨‹ï¼ˆ3-5åˆ†é’Ÿï¼‰

### æ–¹å¼ Aï¼šåœ¨ GitHub æŸ¥çœ‹

1. è®¿é—® Actions é¡µé¢ï¼š
   ```
   https://github.com/djx-ux/-CICD/actions
   ```

2. ä½ ä¼šçœ‹åˆ°å·¥ä½œæµ **"éƒ¨ç½²åˆ°è…¾è®¯äº‘æœåŠ¡å™¨"** æ­£åœ¨è¿è¡Œ

3. ç‚¹å‡»è¿›å…¥æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š
   - âœ… ä»£ç æ£€æŸ¥å’Œæµ‹è¯•
   - âœ… SSH è¿æ¥æœåŠ¡å™¨
   - âœ… åŒæ­¥ä»£ç æ–‡ä»¶
   - âœ… æ„å»º Docker é•œåƒ
   - âœ… éƒ¨ç½²æ–°å®¹å™¨
   - âœ… éªŒè¯éƒ¨ç½²

### æ–¹å¼ Bï¼šåœ¨æœåŠ¡å™¨æŸ¥çœ‹

æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼š

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh root@119.29.95.149

# å®æ—¶æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆæ¯ç§’åˆ·æ–°ï¼‰
watch -n 1 docker ps

# æˆ–è€…æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
tail -f /opt/gin-vue-admin/deploy.log
```

---

## ğŸŒ ç¬¬5æ­¥ï¼šè®¿é—®ä½ çš„åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼ˆGitHub Actions æ˜¾ç¤ºç»¿è‰²âœ“ï¼‰ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š

- **å‰ç«¯**: http://119.29.95.149:8080
- **åç«¯**: http://119.29.95.149:8888

---

## âœ… éªŒè¯éƒ¨ç½²æˆåŠŸ

### åœ¨æœåŠ¡å™¨éªŒè¯

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh root@119.29.95.149

# 1. æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆåº”è¯¥éƒ½æ˜¯ Upï¼‰
docker ps

# è¾“å‡ºç¤ºä¾‹ï¼š
# CONTAINER ID   IMAGE                    STATUS          PORTS
# xxxxx          docker-compose-web       Up 2 minutes    0.0.0.0:80->80/tcp
# xxxxx          docker-compose-serv      Up 2 minutes    0.0.0.0:8888->8888/tcp

# 2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼‰
docker logs docker-compose-web --tail 20
docker logs docker-compose-serv --tail 20

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost:8080
curl -I http://localhost:8888
```

### åœ¨æµè§ˆå™¨éªŒè¯

1. è®¿é—® http://119.29.95.149:8080 - åº”è¯¥çœ‹åˆ°å‰ç«¯é¡µé¢
2. è®¿é—® http://119.29.95.149:8888 - åº”è¯¥çœ‹åˆ°åç«¯å“åº”

å¦‚æœéƒ½èƒ½è®¿é—®ï¼Œ**æ­å–œä½ éƒ¨ç½²æˆåŠŸï¼** ğŸ‰

---

## ğŸ”¥ å¯èƒ½é‡åˆ°çš„é—®é¢˜

### é—®é¢˜ 1ï¼šGitHub Actions å¤±è´¥ - SSH è¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Permission denied (publickey)`

**åŸå› **: SSH å¯†é’¥é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**:
1. é‡æ–°æ£€æŸ¥ GitHub Secret `SERVER_SSH_KEY` çš„å†…å®¹
2. ç¡®ä¿åŒ…å«äº† `-----BEGIN OPENSSH PRIVATE KEY-----` å’Œ `-----END OPENSSH PRIVATE KEY-----`
3. ç¡®ä¿æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œ

**æµ‹è¯• SSH è¿æ¥**:
```bash
# åœ¨æœ¬åœ°æµ‹è¯•ï¼ˆéœ€è¦å…ˆä¿å­˜ç§é’¥åˆ°æ–‡ä»¶ï¼‰
ssh -i ~/.ssh/test_key root@119.29.95.149
```

### é—®é¢˜ 2ï¼šå®¹å™¨æ— æ³•è®¿é—®

**æƒ…å†µ Aï¼šå®¹å™¨æ²¡æœ‰è¿è¡Œ**

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a

# å¦‚æœå®¹å™¨æ˜¯ Exited çŠ¶æ€ï¼ŒæŸ¥çœ‹æ—¥å¿—
docker logs docker-compose-web
docker logs docker-compose-serv

# æ‰‹åŠ¨å¯åŠ¨
cd /opt/gin-vue-admin/deploy/docker-compose
docker-compose up -d
```

**æƒ…å†µ Bï¼šç«¯å£æ— æ³•è®¿é—®**

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :8080
netstat -tlnp | grep :8888

# æ£€æŸ¥é˜²ç«å¢™
ufw status

# å¦‚æœç«¯å£è¢«é˜»æ­¢ï¼Œå¼€æ”¾ç«¯å£
ufw allow 8080
ufw allow 8888
```

**æƒ…å†µ Cï¼šè…¾è®¯äº‘å®‰å…¨ç»„æœªå¼€æ”¾ç«¯å£**

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ **äº‘æœåŠ¡å™¨** â†’ æ‰¾åˆ°ä½ çš„æœåŠ¡å™¨
3. ç‚¹å‡» **å®‰å…¨ç»„** æ ‡ç­¾
4. ç¡®ä¿å…¥ç«™è§„åˆ™åŒ…å«ï¼š
   - TCP 8080 ç«¯å£ï¼ˆ0.0.0.0/0ï¼‰
   - TCP 8888 ç«¯å£ï¼ˆ0.0.0.0/0ï¼‰
   - TCP 22 ç«¯å£ï¼ˆSSHï¼Œå¯é™åˆ¶ä¸ºä½ çš„IPï¼‰

### é—®é¢˜ 3ï¼šdocker-compose æ–‡ä»¶æ‰¾ä¸åˆ°

**é”™è¯¯**: `docker-compose.yaml not found`

**è§£å†³**:
```bash
# SSH åˆ°æœåŠ¡å™¨
ssh root@119.29.95.149

# æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/gin-vue-admin/
ls -la /opt/gin-vue-admin/deploy/docker-compose/

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ä»£ç åŒæ­¥å¤±è´¥
# æ£€æŸ¥ GitHub Actions æ—¥å¿—ä¸­çš„ "åŒæ­¥ä»£ç åˆ°æœåŠ¡å™¨" æ­¥éª¤
```

---

## ğŸ”„ åç»­ä½¿ç”¨

### æ¯æ¬¡æ›´æ–°ä»£ç 

```bash
# 1. ä¿®æ”¹ä»£ç 
# ... ç¼–å†™ä½ çš„åŠŸèƒ½ ...

# 2. æäº¤åˆ° Git
git add .
git commit -m "feat: æè¿°ä½ çš„æ›´æ–°"

# 3. æ¨é€åˆ° GitHub
git push origin main

# 4. ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²ï¼ˆ3-5åˆ†é’Ÿï¼‰
# è®¿é—® https://github.com/djx-ux/-CICD/actions æŸ¥çœ‹è¿›åº¦

# 5. éƒ¨ç½²å®Œæˆåï¼Œåˆ·æ–°æµè§ˆå™¨æŸ¥çœ‹æ›´æ–°
```

å°±è¿™ä¹ˆç®€å•ï¼æ¯æ¬¡æ¨é€éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½² ğŸš€

### æ‰‹åŠ¨ç®¡ç†æœåŠ¡å™¨

```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@119.29.95.149

# æŸ¥çœ‹å®¹å™¨
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker logs -f docker-compose-web
docker logs -f docker-compose-serv

# é‡å¯å®¹å™¨
docker restart docker-compose-web
docker restart docker-compose-serv

# æˆ–ä½¿ç”¨ docker-compose
cd /opt/gin-vue-admin/deploy/docker-compose
docker-compose restart
```

---

## ğŸ“‹ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æœåŠ¡å™¨æ“ä½œ

```bash
# è¿æ¥
ssh root@119.29.95.149

# æŸ¥çœ‹å®¹å™¨
docker ps
docker ps -a  # åŒ…æ‹¬å·²åœæ­¢çš„

# æŸ¥çœ‹æ—¥å¿—
docker logs -f [å®¹å™¨å]
docker logs --tail 100 [å®¹å™¨å]

# é‡å¯æœåŠ¡
docker restart [å®¹å™¨å]
cd /opt/gin-vue-admin/deploy/docker-compose && docker-compose restart

# æŸ¥çœ‹èµ„æº
docker stats
htop
df -h
```

### Git æ“ä½œ

```bash
# æŸ¥çœ‹çŠ¶æ€
git status
git log --oneline -5

# æ¨é€ä»£ç 
git push origin main

# å›æ»šï¼ˆå¦‚æœéœ€è¦ï¼‰
git revert HEAD
git push origin main
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ æ‹¥æœ‰äº†ï¼š

âœ… **å…¨è‡ªåŠ¨éƒ¨ç½²** - æ¨é€ä»£ç  â†’ è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨  
âœ… **å®æ—¶åé¦ˆ** - GitHub Actions æ˜¾ç¤ºéƒ¨ç½²è¿›åº¦  
âœ… **ä¾¿æ·ç®¡ç†** - SSH éšæ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€  
âœ… **å¿«é€Ÿå›æ»š** - Git revert å³å¯å›æ»šç‰ˆæœ¬  

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- **GitHub Actions æ—¥å¿—**: https://github.com/djx-ux/-CICD/actions
- **è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ `SERVER_DEPLOY_GUIDE.md`
- **æœåŠ¡å™¨æ—¥å¿—**: `ssh root@119.29.95.149` ç„¶å `docker logs`

---

**ç°åœ¨å°±å¼€å§‹ç¬¬1æ­¥å§ï¼** ğŸ‘‰ [é…ç½® GitHub Secret](#-ç¬¬1æ­¥é…ç½®-github-secretå¿…éœ€2åˆ†é’Ÿ)

é…ç½®å®Œæˆåæ¨é€ä»£ç ï¼Œç­‰å¾…3-5åˆ†é’Ÿï¼Œä½ çš„åº”ç”¨å°±ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ğŸš€

